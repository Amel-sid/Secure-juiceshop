---
# ğŸ” CrÃ©er rÃ©pertoire SSL
- name: ğŸ” CrÃ©er rÃ©pertoire SSL
  file:
    path: "{{ nginx_ssl_path }}"
    state: directory
    mode: '0755'
  become: yes

# ğŸ” GÃ©nÃ©rer certificats auto-signÃ©s
- name: ğŸ” GÃ©nÃ©rer certificats SSL auto-signÃ©s
  shell: |
    openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout {{ nginx_ssl_path }}/selfsigned.key \
    -out {{ nginx_ssl_path }}/selfsigned.crt \
    -subj "/C=FR/ST=State/L=City/O=JuiceShop/CN=localhost"
  args:
    creates: "{{ nginx_ssl_path }}/selfsigned.crt"
  become: yes

# ğŸ”’ SÃ©curiser les permissions
- name: ğŸ”’ SÃ©curiser permissions certificats
  file:
    path: "{{ item }}"
    mode: '0600'
    owner: root
    group: root
  loop:
    - "{{ nginx_ssl_path }}/selfsigned.key"
    - "{{ nginx_ssl_path }}/selfsigned.crt"
  become: yes